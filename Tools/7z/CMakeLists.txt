srkSetProject()

set(exe ${PROJECT_BINARY_DIR}/install/7zz-22.00.exe)
set(dlFileName 7z2200-src.7z)
set(dlFileHash aa875031817c65b8e1069c5bfa12fa0176ba01431f78489656b411cc2e7c572c)
set(dlFilePath ${PROJECT_BINARY_DIR}/download/${dlFileName})
set(srcDir ${PROJECT_BINARY_DIR}/src/CPP/7zip/Bundles/Alone2)

set_property(GLOBAL PROPERTY 7Z_EXE ${exe})

if (NOT (EXISTS ${exe}))
    srkTryDownloadFile(https://www.7-zip.org/a/${dlFileName} ${dlFilePath} ${dlFileHash})
    file(REMOVE_RECURSE ${PROJECT_BINARY_DIR}/src)
    file(ARCHIVE_EXTRACT INPUT ${dlFilePath} DESTINATION ${PROJECT_BINARY_DIR}/src)

    #cmake_host_system_information(RESULT osName QUERY OS_PLATFORM)
    if (SRK_CXX_COMPILER_MSVC)
        set(vcvarsall "nil")
        srkFindParentDir(${CMAKE_CXX_COMPILER} vcvarsall "VC")
        if (NOT (${vcvarsall} STREQUAL "nil"))
            set(vcvarsall ${vcvarsall}/Auxiliary/Build/vcvarsall.bat)

            set(arch "nil")
            if (SRK_HOST_ARCH_X86)
                if (SRK_HOST_ARCH_WORD_BITS_32)
                    set(arch "x86")
                elseif (SRK_HOST_ARCH_WORD_BITS_64)
                    set(arch "x64")
                endif ()
            elseif (SRK_HOST_ARCH_ARM)
                if (SRK_HOST_ARCH_WORD_BITS_32)
                    set(arch "arm")
                elseif (SRK_HOST_ARCH_WORD_BITS_64)
                    set(arch "arm64")
                endif ()
            endif ()

            if (NOT (${arch} STREQUAL "nil"))
                execute_process(COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/build.bat ${vcvarsall} ${arch} WORKING_DIRECTORY ${srcDir} RESULT_VARIABLE err)
                execute_process(COMMAND ${CMAKE_COMMAND} -E copy_if_different ${srcDir}/${arch}/7zz.exe ${exe})
            endif ()
        endif ()
    endif ()
endif ()