srkSetSubProject(${SRK_TOOL_PROJ_PREFIX})

set(installDir ${PROJECT_BINARY_DIR}/install)
set(binDir ${installDir}/bin)

set_property(GLOBAL PROPERTY SRKPROJ_TOOL_FLEX_NAME ${PROJECT_NAME})
set_property(GLOBAL PROPERTY SRKPROJ_TOOL_FLEX_BIN_DIR ${binDir})

get_property(SRKPROJ_TOOL_AUTOCONF_NAME GLOBAL PROPERTY "SRKPROJ_TOOL_AUTOCONF_NAME")
get_property(SRKPROJ_TOOL_AUTOCONF_BIN_DIR GLOBAL PROPERTY "SRKPROJ_TOOL_AUTOCONF_BIN_DIR")

get_property(SRKPROJ_TOOL_AUTOMAKE_NAME GLOBAL PROPERTY "SRKPROJ_TOOL_AUTOMAKE_NAME")
get_property(SRKPROJ_TOOL_AUTOMAKE_BIN_DIR GLOBAL PROPERTY "SRKPROJ_TOOL_AUTOMAKE_BIN_DIR")

get_property(SRKPROJ_TOOL_BISON_NAME GLOBAL PROPERTY "SRKPROJ_TOOL_BISON_NAME")
get_property(SRKPROJ_TOOL_BISON_DIR GLOBAL PROPERTY "SRKPROJ_TOOL_BISON_DIR")

get_property(SRKPROJ_TOOL_GETTEXT_NAME GLOBAL PROPERTY "SRKPROJ_TOOL_GETTEXT_NAME")
get_property(SRKPROJ_TOOL_GETTEXT_BIN_DIR GLOBAL PROPERTY "SRKPROJ_TOOL_GETTEXT_BIN_DIR")

get_property(SRKPROJ_TOOL_HELP2MAN_NAME GLOBAL PROPERTY "SRKPROJ_TOOL_HELP2MAN_NAME")
get_property(SRKPROJ_TOOL_HELP2MAN_BIN_DIR GLOBAL PROPERTY "SRKPROJ_TOOL_HELP2MAN_BIN_DIR")

get_property(SRKPROJ_TOOL_INDENT_NAME GLOBAL PROPERTY "SRKPROJ_TOOL_INDENT_NAME")
get_property(SRKPROJ_TOOL_INDENT_BIN_DIR GLOBAL PROPERTY "SRKPROJ_TOOL_INDENT_BIN_DIR")

get_property(SRKPROJ_TOOL_LIBTOOL_NAME GLOBAL PROPERTY "SRKPROJ_TOOL_LIBTOOL_NAME")
get_property(SRKPROJ_TOOL_LIBTOOL_BIN_DIR GLOBAL PROPERTY "SRKPROJ_TOOL_LIBTOOL_BIN_DIR")

get_property(SRKPROJ_TOOL_M4_NAME GLOBAL PROPERTY "SRKPROJ_TOOL_M4_NAME")
get_property(SRKPROJ_TOOL_M4_BIN_DIR GLOBAL PROPERTY "SRKPROJ_TOOL_M4_BIN_DIR")

get_property(SRKPROJ_TOOL_TEXINFO_NAME GLOBAL PROPERTY "SRKPROJ_TOOL_TEXINFO_NAME")
get_property(SRKPROJ_TOOL_TEXINFO_BIN_DIR GLOBAL PROPERTY "SRKPROJ_TOOL_TEXINFO_BIN_DIR")

set(ver 2.6.4)
set(fileName flex-${ver}.tar.gz)
srkCheckExternalProjectVersion_DownloadFile(${PROJECT_BINARY_DIR} ${PROJECT_BINARY_DIR}/download/${fileName})

set(path '${SRKPROJ_TOOL_AUTOCONF_BIN_DIR}':'${SRKPROJ_TOOL_AUTOMAKE_BIN_DIR}':'${SRKPROJ_TOOL_BISON_DIR}':'${SRKPROJ_TOOL_GETTEXT_BIN_DIR}':'${SRKPROJ_TOOL_HELP2MAN_BIN_DIR}':'${SRKPROJ_TOOL_INDENT_BIN_DIR}':'${SRKPROJ_TOOL_LIBTOOL_BIN_DIR}':'${SRKPROJ_TOOL_M4_BIN_DIR}':'${SRKPROJ_TOOL_TEXINFO_BIN_DIR}')
message("==  ${path}")

include(ExternalProject)

ExternalProject_Add(
    ${PROJECT_NAME}
    PREFIX ${PROJECT_BINARY_DIR}
    URL https://github.com/westes/flex/releases/download/v${ver}/${fileName}
    DOWNLOAD_NO_EXTRACT ON
    TMP_DIR tmp
    STAMP_DIR stamp
    DOWNLOAD_DIR download
    INSTALL_DIR install
    SOURCE_DIR src
    BINARY_DIR ${SRK_PROJECT_BUILD_ROOT_DIR}
    UPDATE_COMMAND ""
    CONFIGURE_COMMAND
        tar -xf ${PROJECT_BINARY_DIR}/download/${fileName} -C ${PROJECT_BINARY_DIR}/src --strip-components 1
        COMMAND sh ${CMAKE_CURRENT_SOURCE_DIR}/autogen.sh ${path} ${PROJECT_BINARY_DIR}/src
        COMMAND sh ${CMAKE_CURRENT_SOURCE_DIR}/configure.sh ${path} ${PROJECT_BINARY_DIR}/src ${installDir}
    BUILD_COMMAND make
    INSTALL_COMMAND make install
)

add_dependencies(${PROJECT_NAME} ${SRKPROJ_TOOL_AUTOCONF_NAME} ${SRKPROJ_TOOL_AUTOMAKE_NAME} ${SRKPROJ_TOOL_BISON_NAME} ${SRKPROJ_TOOL_GETTEXT_NAME} ${SRKPROJ_TOOL_HELP2MAN_NAME} ${SRKPROJ_TOOL_INDENT_NAME} ${SRKPROJ_TOOL_LIBTOOL_NAME} ${SRKPROJ_TOOL_M4_NAME} ${SRKPROJ_TOOL_TEXINFO_NAME})
set_property(TARGET ${PROJECT_NAME} PROPERTY FOLDER ${SRK_TOOL_DIR_NAME})