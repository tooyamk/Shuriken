file(REMOVE_RECURSE ${INSTALL_DIR})

if (SRK_HOST_OS_WINDOWS)
    set(p "nil")
    if (SRK_HOST_ARCH_X86)
        if (SRK_HOST_ARCH_WORD_BITS_32)
            set(p Win32)
            set(dir win32)
        elseif (SRK_HOST_ARCH_WORD_BITS_64)
            set(p x64)
            set(dir amd64)
        endif ()
    elseif (SRK_HOST_ARCH_ARM)
        if (SRK_HOST_ARCH_WORD_BITS_32)
            set(p ARM)
            set(dir arm)
        elseif (SRK_HOST_ARCH_WORD_BITS_64)
            set(p ARM64)
            set(dir arm64)
        endif ()
    endif ()

    if (NOT (${p} STREQUAL "nil"))
        file(REMOVE_RECURSE ${SRC_DIR}/PCbuild/${dir})
        execute_process(COMMAND ${SRC_DIR}/PCbuild/build.bat -p ${p} RESULT_VARIABLE err)
        file(COPY ${SRC_DIR}/PCbuild/${dir}/ DESTINATION ${INSTALL_DIR} FILES_MATCHING PATTERN "*.*" PATTERN "*.exp" EXCLUDE PATTERN "*.lib" EXCLUDE PATTERN "*.pdb" EXCLUDE PATTERN "*.env" EXCLUDE PATTERN "_test*.*" EXCLUDE)
        execute_process(COMMAND tar -cf ${INSTALL_DIR}/python${MAJOR}${MINOR}.zip --format=zip * WORKING_DIRECTORY ${SRC_DIR}/Lib RESULT_VARIABLE err)
        file(WRITE ${INSTALL_DIR}/python${MAJOR}${MINOR}._pth "python${MAJOR}${MINOR}.zip\r\n.\r\nimport site")
        file(WRITE ${INSTALL_DIR}/Lib/site-packages/start_path.pth "import sys;import os;sys.path.insert(0,os.path.dirname(sys.argv[0]));")

        file(REMOVE_RECURSE ${SRC_DIR}/PCbuild/${dir})
        file(REMOVE_RECURSE ${SRC_DIR}/PCbuild/obj)
        file(REMOVE_RECURSE ${SRC_DIR}/PCbuild/win32)
    endif ()
endif ()